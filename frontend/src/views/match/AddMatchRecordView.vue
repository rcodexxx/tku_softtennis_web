<template>
  <div class="record-match-page container-fluid mt-4 mb-5 px-md-4">
    <n-card :bordered="false" class="form-card">
      <!-- È†ÅÈù¢Ê®ôÈ°å -->
      <div class="page-header mb-4">
        <n-button quaternary circle style="margin-right: 1rem" @click="goBack">
          <template #icon>
            <n-icon :component="ArrowLeftIcon" />
          </template>
        </n-button>
        <h1 class="page-title">Ë®òÈåÑÊñ∞ÊØîË≥Ω</h1>
      </div>

      <!-- Ë°®ÂñÆÂÖßÂÆπ -->
      <n-form
        ref="formRef"
        :model="matchForm"
        :rules="formRules"
        label-placement="top"
        @submit.prevent="handleRecordMatch"
      >
        <!-- ÊØîË≥ΩÂü∫Êú¨Ë≥áË®ä -->
        <n-divider style="margin-top: 2rem; margin-bottom: 2rem">
          <n-text style="font-size: 14px; color: #666">ÊØîË≥ΩÂü∫Êú¨Ë≥áË®ä</n-text>
        </n-divider>
        <n-grid :x-gap="20" :y-gap="20" cols="1 s:3" responsive="screen" align-items="start">
          <n-form-item-gi label="ÊØîË≥ΩÊó•Êúü" path="match_date">
            <n-date-picker
              v-model:value="matchForm.match_date_ts"
              type="date"
              placeholder="ÈÅ∏ÊìáÊØîË≥ΩÊó•Êúü"
              style="width: 100%"
              size="large"
            />
          </n-form-item-gi>
          <n-form-item-gi label="ÊØîË≥ΩÈ°ûÂûã" path="match_type">
            <n-select v-model:value="matchForm.match_type" :options="matchTypeOptions" size="large" />
          </n-form-item-gi>
          <n-form-item-gi label="Ë≥ΩÂà∂" path="match_format">
            <n-select v-model:value="matchForm.match_format" :options="matchFormatOptions" size="large" />
          </n-form-item-gi>
        </n-grid>

        <!-- ÁêÉÂì°ÈÅ∏ÊìáÂçÄÂüü - ‰ΩøÁî®ÁµÑ‰ª∂ -->
        <n-divider style="margin-top: 2rem; margin-bottom: 2rem">
          <n-text style="font-size: 14px; color: #666">ÁêÉÂì°Ë®≠ÂÆö</n-text>
        </n-divider>

        <MatchPlayerSelector v-model="matchForm" />

        <!-- ÂèØÊäòÁñäÁöÑË©≥Á¥∞Ë®≠ÂÆöÂçÄÂ°ä -->
        <n-divider style="margin-top: 2rem; margin-bottom: 1rem">
          <n-button text style="color: #666; font-size: 14px" @click="showAdvancedSettings = !showAdvancedSettings">
            <template #icon>
              <n-icon :component="showAdvancedSettings ? ChevronUpIcon : ChevronDownIcon" />
            </template>
            Ë©≥Á¥∞Ë®≠ÂÆö (ÈÅ∏Â°´)
          </n-button>
        </n-divider>

        <!-- ÂèØÊäòÁñäÂÖßÂÆπ -->
        <n-collapse-transition :show="showAdvancedSettings">
          <div class="advanced-settings-container">
            <!-- Â†¥Âú∞Ë≥áË®ä -->
            <div class="settings-section">
              <n-grid :x-gap="16" :y-gap="16" cols="1 s:3" responsive="screen" class="mt-3">
                <n-form-item-gi label="Â†¥Âú∞ÊùêË≥™" path="court_surface">
                  <n-select
                    v-model:value="matchForm.court_surface"
                    :options="courtSurfaceOptions"
                    placeholder="ÈÅ∏ÊìáÂ†¥Âú∞ÊùêË≥™"
                    clearable
                    size="medium"
                  />
                </n-form-item-gi>

                <n-form-item-gi label="Â†¥Âú∞Áí∞Â¢É" path="court_environment">
                  <n-select
                    v-model:value="matchForm.court_environment"
                    :options="courtEnvironmentOptions"
                    placeholder="ÈÅ∏ÊìáÂ†¥Âú∞Áí∞Â¢É"
                    clearable
                    size="medium"
                  />
                </n-form-item-gi>

                <n-form-item-gi label="ÊØîË≥ΩÊôÇÊÆµ" path="time_slot">
                  <n-select
                    v-model:value="matchForm.time_slot"
                    :options="timeSlotOptions"
                    placeholder="ÈÅ∏ÊìáÊØîË≥ΩÊôÇÊÆµ"
                    clearable
                    size="medium"
                  />
                </n-form-item-gi>
              </n-grid>
            </div>

            <!-- ÊØîË≥ΩË©≥Á¥∞Ë≥áË®ä -->
            <div class="settings-section">
              <n-grid :x-gap="16" :y-gap="16" cols="1 s:2" responsive="screen" class="mt-3">
                <!-- ÁßªÈô§Á∏ΩÂæóÂàÜÔºåÂè™‰øùÁïôÊôÇÈñìÂíåYouTubeÈÄ£Áµê -->
                <n-form-item-gi label="ÊØîË≥ΩÊôÇÈï∑ (ÂàÜÈêò)" path="duration_minutes">
                  <n-input-number
                    v-model:value="matchForm.duration_minutes"
                    placeholder="ÂàÜÈêò"
                    :min="10"
                    :max="180"
                    clearable
                    size="medium"
                    style="width: 100%"
                  />
                </n-form-item-gi>

                <n-form-item-gi label="YouTube Á∂≤ÂùÄ" path="youtube_url">
                  <n-input
                    v-model:value="matchForm.youtube_url"
                    placeholder="https://www.youtube.com/watch?v=..."
                    clearable
                    size="medium"
                  />
                </n-form-item-gi>
              </n-grid>

              <!-- Ë©≥Á¥∞ÊØîÂàÜË®òÈåÑ -->
              <div class="detailed-score-section">
                <n-divider style="margin: 1.5rem 0 1rem 0">
                  <div class="score-section-header">
                    <span class="score-title">Ë©≥Á¥∞ÊØîÂàÜË®òÈåÑ</span>
                  </div>
                </n-divider>

                <div class="score-toggle-container">
                  <n-button
                    text
                    type="primary"
                    class="toggle-detailed-btn"
                    size="medium"
                    @click="enableDetailedScoring = !enableDetailedScoring"
                  >
                    <template #icon>
                      <n-icon>
                        <CheckboxOutline v-if="!enableDetailedScoring" />
                        <CheckboxSharp v-else />
                      </n-icon>
                    </template>
                    {{ enableDetailedScoring ? 'Â∑≤ÂïüÁî®Ë©≥Á¥∞Ë®òÈåÑ' : 'ÂïüÁî®Ë©≥Á¥∞Ë®òÈåÑ' }}
                  </n-button>
                </div>

                <!-- Ë©≥Á¥∞ÊØîÂàÜÂÖßÂÆπ -->
                <n-collapse-transition :show="enableDetailedScoring">
                  <div class="detailed-score-content">
                    <!-- üÜï ÂÖàÁôºÁêÉÈÅ∏ÊìáÂíåÈ°ØÁ§∫Ê®°ÂºèÈÅ∏Êìá -->
                    <div class="control-panel">
                      <div class="serve-selector">
                        <n-form-item label="ÂÖàÁôºÁêÉÊñπ" :show-feedback="false" size="small">
                          <n-radio-group v-model:value="matchForm.first_serve_side" size="small">
                            <n-space>
                              <n-radio value="side_a">AÊñπÂÖàÁôº</n-radio>
                              <n-radio value="side_b">BÊñπÂÖàÁôº</n-radio>
                            </n-space>
                          </n-radio-group>
                        </n-form-item>
                      </div>

                      <div class="display-mode-selector">
                        <n-form-item label="È°ØÁ§∫Ê®°Âºè" :show-feedback="false" size="small">
                          <n-radio-group v-model:value="scoreDisplayMode" size="small">
                            <n-space>
                              <n-radio value="table">Ë°®Ê†ºÊ®°Âºè</n-radio>
                              <n-radio value="cards">Âç°ÁâáÊ®°Âºè</n-radio>
                            </n-space>
                          </n-radio-group>
                        </n-form-item>
                      </div>
                    </div>

                    <!-- Ë°®Ê†ºÊ®°Âºè -->
                    <div v-if="scoreDisplayMode === 'table'" class="score-table-mode">
                      <n-table :bordered="false" :single-line="false" size="small" class="score-table">
                        <thead>
                          <tr>
                            <th style="text-align: center; width: 20%">Â±ÄÊï∏</th>
                            <!-- üîß ÁßªÈô§Ê®ôÈ°åÊ¨ÑÁöÑÁ∂≤ÁêÉicon -->
                            <th style="text-align: center; width: 20%">AÊñπÂæóÂàÜ</th>
                            <th style="text-align: center; width: 20%">BÊñπÂæóÂàÜ</th>
                            <th style="text-align: center; width: 25%">ÁãÄÊÖã</th>
                            <th style="text-align: center; width: 15%">Êìç‰Ωú</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr
                            v-for="gameNum in maxGames"
                            :key="gameNum"
                            :class="{
                              'completed-row': isGameCompleted(gameNum),
                              'disabled-row': isGameDisabled(gameNum),
                              'invalid-row': getScoreInputStatus(gameNum)?.type === 'error',
                              'tiebreak-row': isTiebreakGame(gameNum)
                            }"
                          >
                            <td style="text-align: center">
                              <!-- Â±ÄÊï∏Ê®ôÈ°åÂê´ Tiebreak Ê®ôË≠ò -->
                              <div class="game-number-cell">
                                <strong>{{ getGameTitle(gameNum) }}</strong>
                                <div v-if="isTiebreakGame(gameNum)" class="tiebreak-badge">
                                  <n-tag type="warning" size="tiny" round>Ê±∫ÂãùÂ±Ä</n-tag>
                                </div>
                              </div>
                            </td>
                            <!-- üÜï AÊñπÂæóÂàÜÂê´ÂãïÊÖãÁôºÁêÉÈ°ØÁ§∫ -->
                            <td style="text-align: center">
                              <div class="score-input-container">
                                <!-- üéæ Á∂≤ÁêÉiconÈ°ØÁ§∫Âú®Ëº∏ÂÖ•Ê°ÜÂâç -->
                                <span v-if="isATeamServing(gameNum)" class="serve-icon table-serve-icon" title="AÊñπÁôºÁêÉ"
                                  >üéæ</span
                                >
                                <n-input-number
                                  v-model:value="matchForm[`game${gameNum}_a_score`]"
                                  :min="0"
                                  :max="50"
                                  :disabled="isGameDisabled(gameNum)"
                                  :status="getScoreInputStatus(gameNum)?.type"
                                  size="small"
                                  style="width: 100%; max-width: 80px"
                                  @update:value="updateGameStatistics"
                                />
                              </div>
                            </td>
                            <!-- üÜï BÊñπÂæóÂàÜÂê´ÂãïÊÖãÁôºÁêÉÈ°ØÁ§∫ -->
                            <td style="text-align: center">
                              <div class="score-input-container">
                                <!-- üéæ Á∂≤ÁêÉiconÈ°ØÁ§∫Âú®Ëº∏ÂÖ•Ê°ÜÂâç -->
                                <span v-if="isBTeamServing(gameNum)" class="serve-icon table-serve-icon" title="BÊñπÁôºÁêÉ"
                                  >üéæ</span
                                >
                                <n-input-number
                                  v-model:value="matchForm[`game${gameNum}_b_score`]"
                                  :min="0"
                                  :max="50"
                                  :disabled="isGameDisabled(gameNum)"
                                  :status="getScoreInputStatus(gameNum)?.type"
                                  size="small"
                                  style="width: 100%; max-width: 80px"
                                  @update:value="updateGameStatistics"
                                />
                              </div>
                            </td>
                            <td style="text-align: center">
                              <!-- Ë©≥Á¥∞ÁãÄÊÖãÈ°ØÁ§∫ -->
                              <div class="game-status-display">
                                <n-tag
                                  v-if="isGameCompleted(gameNum)"
                                  :type="getGameResultType(gameNum)"
                                  size="small"
                                  round
                                >
                                  {{ getGameResult(gameNum) }}
                                </n-tag>
                                <n-tag
                                  v-else-if="getScoreInputStatus(gameNum)"
                                  :type="getScoreInputStatus(gameNum).type"
                                  size="small"
                                  round
                                >
                                  {{ getScoreInputStatus(gameNum).message }}
                                </n-tag>
                                <span v-else-if="isGameDisabled(gameNum)" style="color: #ccc">
                                  <n-icon><LockClosedOutline /></n-icon> Â∑≤ÈéñÂÆö
                                </span>
                                <span v-else style="color: #ccc">{{
                                  isTiebreakGame(gameNum) ? 'Êú™ÈñãÂßã (Tiebreak)' : 'Êú™ÈñãÂßã'
                                }}</span>
                              </div>
                            </td>
                            <td style="text-align: center">
                              <!-- ÈáçÁΩÆÊåâÈàï -->
                              <n-button
                                v-if="
                                  (matchForm[`game${gameNum}_a_score`] > 0 ||
                                    matchForm[`game${gameNum}_b_score`] > 0) &&
                                  !isGameDisabled(gameNum)
                                "
                                size="tiny"
                                type="warning"
                                ghost
                                style="padding: 2px 8px"
                                @click="resetGameScore(gameNum)"
                              >
                                ÈáçÁΩÆ
                              </n-button>
                            </td>
                          </tr>
                        </tbody>
                      </n-table>
                    </div>

                    <!-- Âç°ÁâáÊ®°Âºè -->
                    <div v-else class="score-cards-mode">
                      <n-grid :x-gap="12" :y-gap="12" :cols="getCardsPerRow">
                        <n-grid-item v-for="gameNum in maxGames" :key="gameNum">
                          <n-card
                            size="small"
                            class="game-score-card"
                            :class="{
                              'completed-card': isGameCompleted(gameNum),
                              'disabled-card': isGameDisabled(gameNum),
                              'invalid-card': getScoreInputStatus(gameNum)?.type === 'error',
                              'deuce-card': getGameStatus(gameNum)?.status === 'deuce',
                              'advantage-card': getGameStatus(gameNum)?.status === 'advantage',
                              'tiebreak-card': isTiebreakGame(gameNum)
                            }"
                          >
                            <template #header>
                              <div class="card-game-header">
                                <!-- Âç°ÁâáÊ®ôÈ°åÂê´ Tiebreak Ê®ôË≠ò -->
                                <div class="card-title-section">
                                  <span>{{ getGameTitle(gameNum) }}</span>
                                  <n-tag v-if="isTiebreakGame(gameNum)" type="warning" size="tiny" round>
                                    Ê±∫ÂãùÂ±Ä
                                  </n-tag>
                                </div>
                                <div class="card-status">
                                  <n-tag
                                    v-if="isGameCompleted(gameNum)"
                                    :type="getGameResultType(gameNum)"
                                    size="tiny"
                                    round
                                  >
                                    {{ getGameResult(gameNum) }}
                                  </n-tag>
                                  <n-tag
                                    v-else-if="getScoreInputStatus(gameNum)"
                                    :type="getScoreInputStatus(gameNum).type"
                                    size="tiny"
                                    round
                                  >
                                    {{ getScoreInputStatus(gameNum).message }}
                                  </n-tag>
                                  <n-icon v-else-if="isGameDisabled(gameNum)" size="16" style="color: #ccc">
                                    <LockClosedOutline />
                                  </n-icon>
                                </div>
                              </div>
                            </template>

                            <n-space vertical :size="8">
                              <!-- üÜï AÊñπËº∏ÂÖ•Âê´ÂãïÊÖãÁôºÁêÉÈ°ØÁ§∫ -->
                              <n-form-item :show-feedback="false" size="small">
                                <template #label>
                                  <div class="team-label">
                                    <!-- üéæ Âç°ÁâáÊ®°ÂºèÔºöÁ∂≤ÁêÉiconÈ°ØÁ§∫Âú®Ê®ôÁ±§Ââç -->
                                    <span
                                      v-if="isATeamServing(gameNum)"
                                      class="serve-icon card-serve-icon"
                                      title="AÊñπÁôºÁêÉ"
                                      >üéæ</span
                                    >
                                    <span>AÊñπ</span>
                                  </div>
                                </template>
                                <n-input-number
                                  v-model:value="matchForm[`game${gameNum}_a_score`]"
                                  :min="0"
                                  :max="50"
                                  :disabled="isGameDisabled(gameNum)"
                                  :status="getScoreInputStatus(gameNum)?.type"
                                  size="small"
                                  style="width: 100%"
                                  @update:value="updateGameStatistics"
                                />
                              </n-form-item>

                              <!-- üÜï BÊñπËº∏ÂÖ•Âê´ÂãïÊÖãÁôºÁêÉÈ°ØÁ§∫ -->
                              <n-form-item :show-feedback="false" size="small">
                                <template #label>
                                  <div class="team-label">
                                    <!-- üéæ Âç°ÁâáÊ®°ÂºèÔºöÁ∂≤ÁêÉiconÈ°ØÁ§∫Âú®Ê®ôÁ±§Ââç -->
                                    <span
                                      v-if="isBTeamServing(gameNum)"
                                      class="serve-icon card-serve-icon"
                                      title="BÊñπÁôºÁêÉ"
                                      >üéæ</span
                                    >
                                    <span>BÊñπ</span>
                                  </div>
                                </template>
                                <n-input-number
                                  v-model:value="matchForm[`game${gameNum}_b_score`]"
                                  :min="0"
                                  :max="50"
                                  :disabled="isGameDisabled(gameNum)"
                                  :status="getScoreInputStatus(gameNum)?.type"
                                  size="small"
                                  style="width: 100%"
                                  @update:value="updateGameStatistics"
                                />
                              </n-form-item>

                              <!-- Âç°ÁâáÊìç‰ΩúÂçÄ -->
                              <div
                                v-if="
                                  (matchForm[`game${gameNum}_a_score`] > 0 ||
                                    matchForm[`game${gameNum}_b_score`] > 0) &&
                                  !isGameDisabled(gameNum)
                                "
                                class="card-actions"
                              >
                                <n-button
                                  size="tiny"
                                  type="warning"
                                  ghost
                                  style="width: 100%"
                                  @click="resetGameScore(gameNum)"
                                >
                                  ÈáçÁΩÆË©≤Â±Ä
                                </n-button>
                              </div>
                            </n-space>
                          </n-card>
                        </n-grid-item>
                      </n-grid>
                    </div>

                    <!-- üÜï Ë®àÂàÜË¶èÂâáË™™ÊòéÔºàÊõ¥Êñ∞ÁâàÔºâ -->
                    <!--<div class="scoring-rules-info">-->
                    <!--  <n-collapse>-->
                    <!--    <n-collapse-item title="ËªüÁ∂≤Ë®àÂàÜË¶èÂâá" name="rules">-->
                    <!--      <div class="rules-content">-->
                    <!--        <n-tabs type="segment" size="small">-->
                    <!--          <n-tab-pane name="regular" tab="‰∏ÄËà¨Â±Ä">-->
                    <!--            <n-ul>-->
                    <!--              <n-li><strong>Âü∫Êú¨Ë¶èÂâáÔºö</strong>ÂÖàÈÅîÂà∞4ÂàÜ‰∏îÈ†òÂÖàÂ∞çÊâãËá≥Â∞ë1ÂàÜÂç≥Áç≤ÂãùË©≤Â±Ä</n-li>-->
                    <!--              <n-li><strong>Âπ≥ÂàÜË¶èÂâáÔºö</strong>Â¶ÇÊûúÂá∫Áèæ3:3Âπ≥ÂàÜÔºåÈúÄË¶ÅÈ†òÂÖà2ÂàÜÊâçËÉΩÁç≤Âãù</n-li>-->
                    <!--              <n-li><strong>Á§∫‰æãÔºö</strong>4:1, 4:2, 4:3 ‚Üí AÊñπÁç≤Âãù</n-li>-->
                    <!--              <n-li><strong>Âä†ÊôÇÁ§∫‰æãÔºö</strong>3:3 ‚Üí 5:3, 6:4, 7:5 ‚Üí È†òÂÖàÊñπÁç≤Âãù</n-li>-->
                    <!--            </n-ul>-->
                    <!--          </n-tab-pane>-->
                    <!--          <n-tab-pane name="tiebreak" tab="Ê±∫ÂãùÂ±Ä (Tiebreak)">-->
                    <!--            <n-ul>-->
                    <!--              <n-li><strong>ÈÅ©Áî®Â±ÄÊï∏Ôºö</strong>{{ getTiebreakGames().join('„ÄÅ') }}</n-li>-->
                    <!--              <n-li><strong>Âü∫Êú¨Ë¶èÂâáÔºö</strong>ÂÖàÈÅîÂà∞7ÂàÜ‰∏îÈ†òÂÖàÂ∞çÊâãËá≥Â∞ë1ÂàÜÂç≥Áç≤ÂãùË©≤Â±Ä</n-li>-->
                    <!--              <n-li><strong>Âπ≥ÂàÜË¶èÂâáÔºö</strong>Â¶ÇÊûúÂá∫Áèæ6:6Âπ≥ÂàÜÔºåÈúÄË¶ÅÈ†òÂÖà2ÂàÜÊâçËÉΩÁç≤Âãù</n-li>-->
                    <!--              <n-li><strong>Á§∫‰æãÔºö</strong>7:1, 7:5, 7:6 ‚Üí AÊñπÁç≤Âãù</n-li>-->
                    <!--              <n-li><strong>Âä†ÊôÇÁ§∫‰æãÔºö</strong>6:6 ‚Üí 8:6, 9:7, 10:8 ‚Üí È†òÂÖàÊñπÁç≤Âãù</n-li>-->
                    <!--            </n-ul>-->
                    <!--          </n-tab-pane>-->
                    <!--        </n-tabs>-->
                    <!--      </div>-->
                    <!--    </n-collapse-item>-->
                    <!--  </n-collapse>-->
                    <!--</div>-->

                    <!--        &lt;!&ndash; üÜï ÁôºÁêÉËº™ÊèõÈ°ØÁ§∫Ë™™Êòé &ndash;&gt;-->
                    <!--<div v-if="matchForm.first_serve_side" class="serve-rotation-info">-->
                    <!--  <n-alert type="info" :show-icon="false" style="margin-top: 1rem">-->
                    <!--    <template #icon>-->
                    <!--      <span class="serve-icon">üéæ</span>-->
                    <!--    </template>-->
                    <!--    <div class="serve-info-content">-->
                    <!--      <strong>ÁôºÁêÉËº™ÊèõÔºö</strong>-->
                    <!--      <span v-if="matchForm.first_serve_side === 'side_a'">-->
                    <!--        AÊñπÂÖàÁôºÁêÉ ‚Üí Â•áÊï∏Â±Ä(1,3,5,7,9)AÊñπÁôºÁêÉÔºåÂÅ∂Êï∏Â±Ä(2,4,6,8)BÊñπÁôºÁêÉ-->
                    <!--      </span>-->
                    <!--      <span v-else>-->
                    <!--        BÊñπÂÖàÁôºÁêÉ ‚Üí Â•áÊï∏Â±Ä(1,3,5,7,9)BÊñπÁôºÁêÉÔºåÂÅ∂Êï∏Â±Ä(2,4,6,8)AÊñπÁôºÁêÉ-->
                    <!--      </span>-->
                    <!--    </div>-->
                    <!--  </n-alert>-->
                    <!--</div>-->

                    <!-- üîß ‰øÆÊîπÂç≥ÊôÇÁµ±Ë®à -->
                    <div class="real-time-statistics">
                      <n-divider style="margin: 1rem 0 0.5rem 0">
                        <n-text style="font-size: 14px; color: #666">Âç≥ÊôÇÁµ±Ë®à</n-text>
                      </n-divider>
                      <n-grid :x-gap="12" :cols="6" class="stats-summary">
                        <n-statistic
                          label="AÊñπÁç≤Âãù"
                          :value="detailedStats.aWins"
                          :value-style="{ color: detailedStats.aWins >= gamesToWin ? '#52c41a' : '#1890ff' }"
                          class="stat-item"
                        />
                        <n-statistic
                          label="BÊñπÁç≤Âãù"
                          :value="detailedStats.bWins"
                          :value-style="{ color: detailedStats.bWins >= gamesToWin ? '#fa8c16' : '#1890ff' }"
                          class="stat-item"
                        />
                        <n-statistic label="Â∑≤ÂÆåÊàêÂ±ÄÊï∏" :value="detailedStats.completedGames" class="stat-item" />
                        <!-- üÜï ÈÄ≤Ë°å‰∏≠Â±ÄÊï∏ -->
                        <n-statistic
                          label="ÈÄ≤Ë°å‰∏≠Â±ÄÊï∏"
                          :value="detailedStats.inProgressGames"
                          :value-style="{ color: detailedStats.inProgressGames > 0 ? '#faad14' : '#1890ff' }"
                          class="stat-item"
                        />
                        <n-statistic label="Á∏ΩÂæóÂàÜ" :value="detailedStats.totalPoints" class="stat-item" />
                        <n-statistic
                          :label="
                            matchForm.first_serve_side === 'side_a'
                              ? 'AÊñπÂÖàÁôº'
                              : matchForm.first_serve_side === 'side_b'
                                ? 'BÊñπÂÖàÁôº'
                                : 'ÂÖàÁôºÁêÉÊñπ'
                          "
                          :value="
                            matchForm.first_serve_side === 'side_a'
                              ? 'üèì A'
                              : matchForm.first_serve_side === 'side_b'
                                ? 'üèì B'
                                : '?'
                          "
                          class="stat-item serve-stat"
                        />
                      </n-grid>
                    </div>
                  </div>
                </n-collapse-transition>
              </div>
            </div>
          </div>
        </n-collapse-transition>

        <!-- Êìç‰ΩúÊåâÈàï -->
        <n-divider style="margin-top: 2rem; margin-bottom: 2rem" />
        <n-space justify="space-between" style="width: 100%">
          <n-button size="large" @click="goBack">
            <template #icon>
              <n-icon :component="ArrowLeftIcon" />
            </template>
            ËøîÂõû
          </n-button>
          <n-space>
            <n-button size="large" @click="resetForm">
              <template #icon>
                <n-icon :component="RefreshIcon" />
              </template>
              ÈáçÁΩÆ
            </n-button>
            <n-button
              type="primary"
              size="large"
              :loading="submitting"
              :disabled="!canSubmit"
              @click="handleRecordMatch"
            >
              <template #icon>
                <n-icon :component="SaveIcon" />
              </template>
              ÂÑ≤Â≠òÊØîË≥ΩÁµêÊûú
            </n-button>
          </n-space>
        </n-space>
      </n-form>
    </n-card>
  </div>
</template>

<script setup>
  // 1. ÂºïÂÖ• (Imports)
  // ÂºïÂÖ• Vue Ê†∏ÂøÉÂäüËÉΩÔºöË®àÁÆóÂ±¨ÊÄß„ÄÅÈüøÊáâÂºèÊï∏Êìö„ÄÅÁõ£ËÅΩÂô®
  import { computed, ref, watch } from 'vue'
  // ÂºïÂÖ• Vue Router Áî®ÊñºÂ∞éËà™
  import { useRouter } from 'vue-router'
  // ÂºïÂÖ• Naive UI ÁöÑÊ∂àÊÅØÊèêÁ§∫ÁµÑ‰ª∂
  import { useMessage } from 'naive-ui'
  // ÂºïÂÖ•Ëá™ÂÆöÁæ©ÁöÑ API ÂÆ¢Êà∂Á´ØÊúçÂãô
  import apiClient from '@/services/apiClient'
  // ÂºïÂÖ•Ëá™ÂÆöÁæ©ÁöÑÁêÉÂì°ÈÅ∏ÊìáÂô®ÁµÑ‰ª∂
  import MatchPlayerSelector from '@/components/MatchPlayerSelector.vue'

  // ÂºïÂÖ• Naive UI ÁöÑÂúñÊ®ô (Icons)
  import {
    ArrowBackOutline as ArrowLeftIcon, // ËøîÂõûÁÆ≠È†≠
    ChevronDownOutline as ChevronDownIcon, // Âêë‰∏ãÁÆ≠È†≠
    ChevronUpOutline as ChevronUpIcon, // Âêë‰∏äÁÆ≠È†≠
    RefreshOutline as RefreshIcon, // Âà∑Êñ∞ÂúñÊ®ô
    SaveOutline as SaveIcon, // ‰øùÂ≠òÂúñÊ®ô
    CheckboxOutline, // Á©∫ÁôΩË§áÈÅ∏Ê°Ü
    CheckboxSharp, // ÂØ¶ÂøÉË§áÈÅ∏Ê°Ü
    LockClosedOutline // ÈéñÂÆöÂúñÊ®ô
  } from '@vicons/ionicons5'

  // 2. ÂØ¶‰æãÂåñ hooks
  // Áç≤ÂèñË∑ØÁî±Âô®ÂØ¶‰æãÔºåÁî®ÊñºÈ†ÅÈù¢Ë∑≥ËΩâ
  const router = useRouter()
  // Áç≤ÂèñÊ∂àÊÅØÊèêÁ§∫ÂØ¶‰æãÔºåÁî®ÊñºÈ°ØÁ§∫ÊàêÂäü/Â§±ÊïóÊ∂àÊÅØ
  const message = useMessage()

  // 3. ÁãÄÊÖãÁÆ°ÁêÜ (State)
  // ÊéßÂà∂È†ÅÈù¢ÊàñÁµÑ‰ª∂ÁöÑËºâÂÖ•ÁãÄÊÖã
  const loading = ref(false)
  // ÊéßÂà∂Ë°®ÂñÆÊèê‰∫§ÁöÑËºâÂÖ•ÁãÄÊÖãÔºåÈò≤Ê≠¢ÈáçË§áÊèê‰∫§
  const submitting = ref(false)
  // ÊéßÂà∂ÊòØÂê¶È°ØÁ§∫ÈÄ≤ÈöéË®≠ÂÆöÂçÄÂ°ä
  const showAdvancedSettings = ref(false)
  // ÂºïÁî®Ë°®ÂñÆÁµÑ‰ª∂ÂØ¶‰æãÔºåÁî®ÊñºËß∏ÁôºË°®ÂñÆÈ©óË≠â
  const formRef = ref(null)
  // ÊòØÂê¶ÂïüÁî®Ë©≥Á¥∞ÊØîÂàÜË®òÈåÑÂäüËÉΩ
  const enableDetailedScoring = ref(false)
  // ÊØîÂàÜÈ°ØÁ§∫Ê®°ÂºèÔºö'table' ÊàñÂÖ∂‰ªñ (Â¶ÇÊûúÊú™‰æÜÊúâ‰∏çÂêåÈ°ØÁ§∫ÊñπÂºè)
  const scoreDisplayMode = ref('table')

  // 4. Ë°®ÂñÆÊï∏Êìö (Form Data)
  // ÊØîË≥ΩË®òÈåÑË°®ÂñÆÁöÑÈüøÊáâÂºèÊï∏ÊìöÊ®°Âûã
  const matchForm = ref({
    match_date_ts: new Date().getTime(), // ÊØîË≥ΩÊó•ÊúüÊôÇÈñìÊà≥ (È†êË®≠ÁÇ∫Áï∂ÂâçÊôÇÈñì)
    match_type: 'doubles', // ÊØîË≥ΩÈ°ûÂûãÔºö'singles' (ÂñÆÊâì) Êàñ 'doubles' (ÈõôÊâì)
    match_format: 'games_9', // Ë≥ΩÂà∂Ôºö'games_5' (‰∫îÂ±Ä), 'games_7' (‰∏ÉÂ±Ä), 'games_9' (‰πùÂ±Ä)
    player1_id: null, // AÊñπÁêÉÂì°1 ID
    player2_id: null, // AÊñπÁêÉÂì°2 ID (ÂÉÖÈõôÊâìÊúâ)
    player3_id: null, // BÊñπÁêÉÂì°1 ID
    player4_id: null, // BÊñπÁêÉÂì°2 ID (ÂÉÖÈõôÊâìÊúâ)
    a_games: 0, // AÊñπÁ∏ΩË¥èÂæóÂ±ÄÊï∏
    b_games: 0, // BÊñπÁ∏ΩË¥èÂæóÂ±ÄÊï∏
    match_notes: '', // ÊØîË≥ΩÂÇôË®ª
    court_surface: 'hard_court', // Â†¥Âú∞Ë°®Èù¢Ôºö'hard_court' (Á°¨Âú∞), 'clay_court' (Á¥ÖÂúü), 'grass_court' (ËçâÂú∞)
    court_environment: 'outdoor', // Â†¥Âú∞Áí∞Â¢ÉÔºö'indoor' (ÂÆ§ÂÖß) Êàñ 'outdoor' (ÂÆ§Â§ñ)
    time_slot: 'evening', // ÊôÇÈñìÊÆµÔºö'morning' (Êó©‰∏ä), 'afternoon' (‰∏ãÂçà), 'evening' (Êôö‰∏ä)
    total_points: null, // Á∏ΩÂàÜ (ÂèØÈÅ∏)
    duration_minutes: null, // ÊØîË≥ΩÊôÇÈï∑ (ÂàÜÈêò, ÂèØÈÅ∏)
    youtube_url: '', // YouTube ÈÄ£Áµê (ÂèØÈÅ∏)
    first_serve_side: null, // Á¨¨‰∏ÄÂ±ÄÁôºÁêÉÊñπ ('side_a' Êàñ 'side_b')

    // Ë©≥Á¥∞Â±ÄÊØîÂàÜÔºåÁî®ÊñºË®òÈåÑÊØè‰∏ÄÂ±ÄÁöÑÂæóÂàÜ (È†êË®≠ÁÇ∫0)
    game1_a_score: 0,
    game1_b_score: 0,
    game2_a_score: 0,
    game2_b_score: 0,
    game3_a_score: 0,
    game3_b_score: 0,
    game4_a_score: 0,
    game4_b_score: 0,
    game5_a_score: 0,
    game5_b_score: 0,
    game6_a_score: 0,
    game6_b_score: 0,
    game7_a_score: 0,
    game7_b_score: 0,
    game8_a_score: 0,
    game8_b_score: 0,
    game9_a_score: 0,
    game9_b_score: 0
  })

  // 5. ÈÅ∏È†ÖÊï∏Êìö (Options Data)
  // ÊØîË≥ΩÈ°ûÂûã‰∏ãÊãâÈÅ∏ÂñÆÈÅ∏È†Ö
  const matchTypeOptions = [
    { label: 'ÂñÆÊâì', value: 'singles' },
    { label: 'ÈõôÊâì', value: 'doubles' }
  ]

  // Ë≥ΩÂà∂‰∏ãÊãâÈÅ∏ÂñÆÈÅ∏È†Ö
  const matchFormatOptions = [
    { label: '‰∫îÂ±ÄÂà∂', value: 'games_5' },
    { label: '‰∏ÉÂ±ÄÂà∂', value: 'games_7' },
    { label: '‰πùÂ±ÄÂà∂', value: 'games_9' }
  ]

  // Â†¥Âú∞Ë°®Èù¢‰∏ãÊãâÈÅ∏ÂñÆÈÅ∏È†Ö
  const courtSurfaceOptions = [
    { label: 'Á°¨Âú∞', value: 'hard_court' },
    { label: 'Á¥ÖÂúü', value: 'clay_court' },
    { label: 'ËçâÂú∞', value: 'grass_court' }
  ]

  // Â†¥Âú∞Áí∞Â¢É‰∏ãÊãâÈÅ∏ÂñÆÈÅ∏È†Ö
  const courtEnvironmentOptions = [
    { label: 'ÂÆ§ÂÖß', value: 'indoor' },
    { label: 'ÂÆ§Â§ñ', value: 'outdoor' }
  ]

  // ÊôÇÈñìÊÆµ‰∏ãÊãâÈÅ∏ÂñÆÈÅ∏È†Ö
  const timeSlotOptions = [
    { label: 'Êó©‰∏ä', value: 'morning' },
    { label: '‰∏ãÂçà', value: 'afternoon' },
    { label: 'Êôö‰∏ä', value: 'evening' }
  ]

  // Ë≥ΩÂà∂ËàáÊúÄÂ§ßÂ±ÄÊï∏ÁöÑÂ∞çÊáâÈÖçÁΩÆ
  const matchFormatConfig = {
    games_5: { maxGames: 5, display: '‰∫îÂ±ÄÂà∂' },
    games_7: { maxGames: 7, display: '‰∏ÉÂ±ÄÂà∂' },
    games_9: { maxGames: 9, display: '‰πùÂ±ÄÂà∂' }
  }

  // 6. ËºîÂä©ÂáΩÊï∏ (Helper Functions) - ËàáÂàÜÊï∏/Â±ÄÊï∏ÈÇèËºØÂº∑Áõ∏Èóú
  /**
   * Ê†πÊìöÁï∂ÂâçË≥ΩÂà∂Áç≤Âèñ Tiebreak Â±ÄÊï∏ÂàóË°®„ÄÇ
   * @returns {string[]} Tiebreak Â±ÄÊï∏ÁöÑÊñáÂ≠óÊèèËø∞Èô£Âàó„ÄÇ
   */
  const getTiebreakGames = () => {
    const format = matchForm.value.match_format
    if (format === 'games_5') return ['Á¨¨5Â±Ä']
    if (format === 'games_7') return ['Á¨¨7Â±Ä']
    if (format === 'games_9') return ['Á¨¨9Â±Ä']
    return []
  }

  /**
   * Ê†πÊìöËªüÁ∂≤Ë¶èÂâáÂà§Êñ∑ÊåáÂÆöÂ±ÄÊï∏ÁöÑÁôºÁêÉÊñπ„ÄÇ
   * ËªüÁ∂≤Ë¶èÂâáÔºöÂ•áÊï∏Â±ÄËàáÁ¨¨‰∏ÄÂ±ÄÁôºÁêÉÊñπÁõ∏ÂêåÔºåÂÅ∂Êï∏Â±ÄÂâáÁõ∏Âèç„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {string|null} ÁôºÁêÉÊñπ ('side_a' Êàñ 'side_b')ÔºåÂ¶ÇÊûúÊú™Ë®≠ÂÆöÁ¨¨‰∏ÄÂ±ÄÁôºÁêÉÊñπÂâáËøîÂõû null„ÄÇ
   */
  const getGameServeTeam = gameNum => {
    if (!matchForm.value.first_serve_side) return null

    if (gameNum % 2 === 1) {
      // Â•áÊï∏Â±Ä (1, 3, 5, 7, 9) ÂíåÁ¨¨‰∏ÄÂ±ÄÁôºÁêÉÊñπÁõ∏Âêå
      return matchForm.value.first_serve_side
    } else {
      // ÂÅ∂Êï∏Â±Ä (2, 4, 6, 8) ÂíåÁ¨¨‰∏ÄÂ±ÄÁôºÁêÉÊñπÁõ∏Âèç
      return matchForm.value.first_serve_side === 'side_a' ? 'side_b' : 'side_a'
    }
  }

  /**
   * Ê™¢Êü•ÊåáÂÆöÂ±ÄÊï∏ÊòØÂê¶ÁÇ∫ A ÊñπÁôºÁêÉ„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {boolean} Â¶ÇÊûúÊòØ A ÊñπÁôºÁêÉÂâáÁÇ∫ trueÔºåÂê¶ÂâáÁÇ∫ false„ÄÇ
   */
  const isATeamServing = gameNum => {
    return getGameServeTeam(gameNum) === 'side_a'
  }

  /**
   * Ê™¢Êü•ÊåáÂÆöÂ±ÄÊï∏ÊòØÂê¶ÁÇ∫ B ÊñπÁôºÁêÉ„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {boolean} Â¶ÇÊûúÊòØ B ÊñπÁôºÁêÉÂâáÁÇ∫ trueÔºåÂê¶ÂâáÁÇ∫ false„ÄÇ
   */
  const isBTeamServing = gameNum => {
    return getGameServeTeam(gameNum) === 'side_b'
  }

  /**
   * Áç≤ÂèñÊåáÂÆöÂ±ÄÊï∏ÁöÑÁôºÁêÉÈ°ØÁ§∫ÊñáÊú¨„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {string} ÁôºÁêÉÊñπÈ°ØÁ§∫ÊñáÊú¨ (‰æãÂ¶Ç 'AÊñπÁôºÁêÉ' Êàñ 'BÊñπÁôºÁêÉ')„ÄÇ
   */
  const getServeDisplayText = gameNum => {
    const serveTeam = getGameServeTeam(gameNum)
    if (!serveTeam) return 'Êú™Ë®≠ÂÆö'
    return serveTeam === 'side_a' ? 'AÊñπÁôºÁêÉ' : 'BÊñπÁôºÁêÉ'
  }

  /**
   * Âà§Êñ∑ÊåáÂÆöÂ±ÄÊï∏ÊòØÂê¶ÁÇ∫ Tiebreak Â±Ä„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {boolean} Â¶ÇÊûúÊòØ Tiebreak Â±ÄÂâáÁÇ∫ trueÔºåÂê¶ÂâáÁÇ∫ false„ÄÇ
   */
  const isTiebreakGame = gameNum => {
    const format = matchForm.value.match_format
    if (format === 'games_5' && gameNum === 5) return true
    if (format === 'games_7' && gameNum === 7) return true
    if (format === 'games_9' && gameNum === 9) return true
    return false
  }

  /**
   * Âà§Êñ∑ÂàÜÊï∏Ëº∏ÂÖ•Ê°ÜÊòØÂê¶ÊáâË©≤Ë¢´Á¶ÅÁî®„ÄÇ
   * Â¶ÇÊûúÊØîË≥ΩÂ∑≤ÁµêÊùü‰∏îË©≤Â±ÄÊú™ÂÆåÊàêÔºåÊàñËÄÖË©≤Â±ÄÂ∑≤ÂÆåÊàêÔºåÂâáÁ¶ÅÁî®„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {boolean} Â¶ÇÊûúÊáâË©≤Á¶ÅÁî®ÂâáÁÇ∫ trueÔºåÂê¶ÂâáÁÇ∫ false„ÄÇ
   */
  const isScoreInputDisabled = gameNum => {
    // Â¶ÇÊûúÊØîË≥ΩÂ∑≤ÁµêÊùü‰∏îË©≤Â±ÄÊú™ÂÆåÊàêÔºåÂâáÁ¶ÅÁî®
    if (matchCompleted.value && !isGameCompleted(gameNum)) return true
    // Â¶ÇÊûúË©≤Â±ÄÂ∑≤ÂÆåÊàêÔºåÂâáÁ¶ÅÁî® (Èô§ÈùûÁî®Êà∂ÊÉ≥‰øÆÊîπÔºåÊ≠§ËôïÈ†êË®≠Á¶ÅÁî®)
    return isGameCompleted(gameNum)
  }

  /**
   * Âà§Êñ∑ÊåáÂÆöÂ±ÄÊï∏ÁöÑÊØîË≥ΩÊòØÂê¶Ë¢´Á¶ÅÁî® (Âõ†ÁÇ∫Á∏ΩÊØîË≥ΩÂ∑≤ÁµêÊùü)„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {boolean} Â¶ÇÊûúË©≤Â±ÄÊáâÁ¶ÅÁî®ÂâáÁÇ∫ trueÔºåÂê¶ÂâáÁÇ∫ false„ÄÇ
   */
  const isGameDisabled = gameNum => {
    // Â¶ÇÊûúÊØîË≥ΩÂ∑≤ÁµêÊùü‰∏îË©≤Â±ÄÊú™ÂÆåÊàêÔºåÂâáÁ¶ÅÁî®
    return matchCompleted.value && !isGameCompleted(gameNum)
  }

  /**
   * Ê†πÊìöËªüÁ∂≤Ë¶èÂâáÂà§Êñ∑Ë©≤Â±ÄÊòØÂê¶ÂÆåÊàê„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {boolean} Â¶ÇÊûúË©≤Â±ÄÂ∑≤ÂÆåÊàêÂâáÁÇ∫ trueÔºåÂê¶ÂâáÁÇ∫ false„ÄÇ
   */
  const isGameCompleted = gameNum => {
    const aScore = matchForm.value[`game${gameNum}_a_score`] || 0
    const bScore = matchForm.value[`game${gameNum}_b_score`] || 0

    if (aScore === 0 && bScore === 0) return false // Â¶ÇÊûúÂàÜÊï∏ÈÉΩÊòØ0ÔºåË°®Á§∫Êú™ÈñãÂßãÊàñÂ∑≤ÈáçÁΩÆÔºå‰∏çÁÆóÂÆåÊàê

    const validation = validateSoftTennisScore(aScore, bScore, gameNum)
    return validation.gameFinished
  }

  /**
   * Áç≤ÂèñÊåáÂÆöÂ±ÄÊï∏ÁöÑÊØîË≥ΩÁµêÊûú (AÂãù/BÂãù/ÈÄ≤Ë°å‰∏≠)„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {string} Â±ÄÊï∏ÁµêÊûú„ÄÇ
   */
  const getGameResult = gameNum => {
    const aScore = matchForm.value[`game${gameNum}_a_score`] || 0
    const bScore = matchForm.value[`game${gameNum}_b_score`] || 0

    const validation = validateSoftTennisScore(aScore, bScore, gameNum)

    if (validation.gameFinished && validation.winner) {
      return validation.winner === 'A' ? 'AÂãù' : 'BÂãù'
    }

    return 'ÈÄ≤Ë°å‰∏≠'
  }

  /**
   * Áç≤ÂèñÊåáÂÆöÂ±ÄÊï∏ÁöÑË©≥Á¥∞ÁãÄÊÖã (‰æãÂ¶Ç: Âπ≥ÂàÜ, È†òÂÖà, ÁµêÊùüÁ≠â)„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {object} ÂåÖÂê´ÁãÄÊÖãÈ°ûÂûãÂíåÊ∂àÊÅØÁöÑÁâ©‰ª∂„ÄÇ
   */
  const getGameStatus = gameNum => {
    const aScore = matchForm.value[`game${gameNum}_a_score`] || 0
    const bScore = matchForm.value[`game${gameNum}_b_score`] || 0

    // Â¶ÇÊûúÈõôÊñπÂàÜÊï∏ÈÉΩÊòØ0ÔºåË°®Á§∫ÈÄôÂ±ÄÈÇÑÊ≤íÈñãÂßã
    if (aScore === 0 && bScore === 0) {
      const isTiebreak = isTiebreakGame(gameNum)
      return {
        status: 'not_started', // Êú™ÈñãÂßãÁãÄÊÖã
        message: isTiebreak ? 'Êú™ÈñãÂßã (Tiebreak)' : 'Êú™ÈñãÂßã'
      }
    }

    // È©óË≠âÁï∂ÂâçÊØîÂàÜÊòØÂê¶Á¨¶ÂêàËªüÁ∂≤Ë¶èÂâá
    const validation = validateSoftTennisScore(aScore, bScore, gameNum)

    // Â¶ÇÊûúÂàÜÊï∏ÁÑ°ÊïàÔºåÁõ¥Êé•ËøîÂõûÈåØË™§ÁãÄÊÖã
    if (!validation.isValid) {
      return { status: 'invalid', message: validation.message }
    }

    // Â¶ÇÊûúË©≤Â±ÄÂ∑≤ÂÆåÊàê
    if (validation.gameFinished) {
      const winner = validation.winner === 'A' ? 'AÊñπ' : 'BÊñπ'
      const isTiebreak = isTiebreakGame(gameNum)
      return {
        status: 'finished', // ÂÆåÊàêÁãÄÊÖã
        message: isTiebreak ? `${winner}Áç≤Âãù (Tiebreak)` : `${winner}Áç≤Âãù`
      }
    }

    // Â¶ÇÊûúË©≤Â±Ä‰ªçÂú®ÈÄ≤Ë°å‰∏≠ÔºåÂàÜÊûêÂÖ∂ÂÖ∑È´îÁãÄÊÖã
    const minScore = Math.min(aScore, bScore)
    const maxScore = Math.max(aScore, bScore)
    const scoreDiff = Math.abs(aScore - bScore)
    const isTiebreak = isTiebreakGame(gameNum)

    if (isTiebreak) {
      // Tiebreak ÁãÄÊÖãÂàÜÊûê
      if (minScore < 6) {
        if (maxScore === 6) {
          return { status: 'close', message: 'Tiebreak Êé•ËøëÂãùË≤†Èªû' } // Êé•ËøëÁµêÊùü
        }
        return { status: 'in_progress', message: 'Tiebreak ÈÄ≤Ë°å‰∏≠' } // ÈÄ≤Ë°å‰∏≠
      } else {
        // 6:6 ÊàñÊõ¥È´òÔºåÈÄ≤ÂÖ• Tiebreak Âä†ÊôÇ (ÈúÄË¶ÅÈ†òÂÖàÂÖ©ÂàÜ)
        if (scoreDiff === 0) {
          return { status: 'deuce', message: `${minScore}:${minScore} TiebreakÂπ≥ÂàÜ` } // Âπ≥ÂàÜ
        } else if (scoreDiff === 1) {
          const leader = aScore > bScore ? 'AÊñπ' : 'BÊñπ'
          return { status: 'advantage', message: `${leader}TiebreakÈ†òÂÖà` } // È†òÂÖà‰ΩÜÊú™ÁµêÊùü
        }
      }
    } else {
      // ‰∏ÄËà¨Â±ÄÁãÄÊÖãÂàÜÊûê
      if (minScore < 3) {
        if (maxScore === 3) {
          return { status: 'close', message: 'Êé•ËøëÂãùË≤†Èªû' } // Êé•ËøëÁµêÊùü
        }
        return { status: 'in_progress', message: 'ÈÄ≤Ë°å‰∏≠' } // ÈÄ≤Ë°å‰∏≠
      } else {
        // 3:3 ÊàñÊõ¥È´òÔºåÈÄ≤ÂÖ•Âä†ÊôÇ (ÈúÄË¶ÅÈ†òÂÖàÂÖ©ÂàÜ)
        if (scoreDiff === 0) {
          return { status: 'deuce', message: `${minScore}:${minScore} Âπ≥ÂàÜ` } // Âπ≥ÂàÜ
        } else if (scoreDiff === 1) {
          const leader = aScore > bScore ? 'AÊñπ' : 'BÊñπ'
          return { status: 'advantage', message: `${leader}È†òÂÖà` } // È†òÂÖà‰ΩÜÊú™ÁµêÊùü
        }
      }
    }

    return { status: 'in_progress', message: 'ÈÄ≤Ë°å‰∏≠' } // È†êË®≠ÁÇ∫ÈÄ≤Ë°å‰∏≠
  }

  /**
   * Ê†πÊìöËªüÁ∂≤Ë¶èÂâáÈ©óË≠âÂñÆÂ±ÄÊØîÂàÜÊòØÂê¶ÊúâÊïàÂèäÊòØÂê¶Â∑≤ÁµêÊùü„ÄÇ
   * ËªüÁ∂≤Ë¶èÂâáÔºö‰∏ÄËà¨Â±ÄÂÖàÂà∞4ÂàÜ‰∏îÈ†òÂÖà1ÂàÜÁç≤ÂãùÔºå3:3ÂæåÈúÄÈ†òÂÖà2ÂàÜ„ÄÇ
   * Tiebreak Â±ÄÂÖàÂà∞7ÂàÜ‰∏îÈ†òÂÖà1ÂàÜÁç≤ÂãùÔºå6:6ÂæåÈúÄÈ†òÂÖà2ÂàÜ„ÄÇ
   * @param {number} aScore - AÊñπÂæóÂàÜ„ÄÇ
   * @param {number} bScore - BÊñπÂæóÂàÜ„ÄÇ
   * @param {number|null} gameNum - (ÂèØÈÅ∏) Â±ÄÊï∏ÔºåÁî®ÊñºÂà§Êñ∑ÊòØÂê¶ÁÇ∫ Tiebreak Â±Ä„ÄÇ
   * @returns {object} ÂåÖÂê´ isValid (ÊòØÂê¶ÊúâÊïà), message (ÊèêÁ§∫‰ø°ÊÅØ), gameFinished (ÊòØÂê¶ÁµêÊùü), winner (ÂãùÊñπ) ÁöÑÁâ©‰ª∂„ÄÇ
   */
  const validateSoftTennisScore = (aScore, bScore, gameNum = null) => {
    // Âü∫Êú¨ÂàÜÊï∏‰∏çËÉΩÁÇ∫Ë≤†Êï∏ÊàñÈÅéÈ´ò
    if (aScore < 0 || bScore < 0) {
      return { isValid: false, message: 'ÂàÜÊï∏‰∏çËÉΩÁÇ∫Ë≤†Êï∏' }
    }
    if (aScore > 50 || bScore > 50) {
      return { isValid: false, message: 'ÂàÜÊï∏ÈÅéÈ´òÔºåË´ãÊ™¢Êü•Ëº∏ÂÖ•' }
    }

    // Â¶ÇÊûúÂàÜÊï∏ÈÉΩÊòØ0ÔºåË°®Á§∫ÈÇÑÊ≤íÈñãÂßãÔºåË¶ñÁÇ∫ÊúâÊïà‰ΩÜÊú™ÁµêÊùü
    if (aScore === 0 && bScore === 0) {
      return { isValid: true, message: '', gameFinished: false, winner: null }
    }

    // Âà§Êñ∑ÊòØÂê¶ÁÇ∫ Tiebreak Â±Ä
    const isTiebreak = gameNum && isTiebreakGame(gameNum)

    if (isTiebreak) {
      // ÊáâÁî® Tiebreak Â±ÄÁöÑÈ©óË≠âË¶èÂâá
      return validateTiebreakScore(aScore, bScore)
    } else {
      // ÊáâÁî®‰∏ÄËà¨Â±ÄÁöÑÈ©óË≠âË¶èÂâá
      return validateRegularGameScore(aScore, bScore)
    }
  }

  /**
   * È©óË≠â Tiebreak Â±ÄÁöÑÊØîÂàÜÊòØÂê¶ÊúâÊïà„ÄÇ
   * @param {number} aScore - AÊñπÂæóÂàÜ„ÄÇ
   * @param {number} bScore - BÊñπÂæóÂàÜ„ÄÇ
   * @returns {object} È©óË≠âÁµêÊûúÁâ©‰ª∂„ÄÇ
   */
  const validateTiebreakScore = (aScore, bScore) => {
    const minScore = Math.min(aScore, bScore)
    const maxScore = Math.max(aScore, bScore)
    const scoreDiff = Math.abs(aScore - bScore)

    // ÊÉÖÊ≥Å1: ÈÇÑÊ≤íÂà∞ 6:6ÔºåÂÖàÂà∞ 7 ÂàÜ‰∏îÈ†òÂÖà 1 ÂàÜÂ∞±Ë¥è
    if (minScore < 6) {
      if (maxScore >= 7 && scoreDiff >= 1) {
        const winner = aScore > bScore ? 'A' : 'B'
        return { isValid: true, message: '', gameFinished: true, winner }
      }
      // Ê™¢Êü•ÊòØÂê¶Âá∫ÁèæÁÑ°ÊïàÂàÜÊï∏ (‰æãÂ¶Ç‰∏ÄÊñπÂ∑≤Âà∞7ÂàÜ‰ΩÜÊú™È†òÂÖà)
      if (maxScore >= 7 && scoreDiff < 1) {
        return { isValid: false, message: 'ÂàÜÊï∏Â∑≤ÈÅîÂà∞ÂãùË≤†Èªû‰ΩÜÊú™ÊãâÈñãÂ∑ÆË∑ùÔºåÁÑ°Êïà' }
      }
      return { isValid: true, message: '', gameFinished: false, winner: null }
    }

    // ÊÉÖÊ≥Å2: Â∑≤Á∂ìÂà∞ 6:6 ÊàñÊõ¥È´òÔºåÈúÄË¶ÅÈ†òÂÖà 2 ÂàÜÊâçËÉΩÁç≤Âãù
    if (minScore >= 6) {
      if (scoreDiff >= 2) {
        const winner = aScore > bScore ? 'A' : 'B'
        return { isValid: true, message: '', gameFinished: true, winner }
      }
      // 6:6 ‰πãÂæåÔºåÂÖÅË®±ÁπºÁ∫åÊØîË≥ΩÁõ¥Âà∞Êúâ‰∏ÄÊñπÈ†òÂÖà 2 ÂàÜ
      return { isValid: true, message: '', gameFinished: false, winner: null }
    }

    return { isValid: true, message: '', gameFinished: false, winner: null }
  }

  /**
   * È©óË≠â‰∏ÄËà¨Â±ÄÁöÑÊØîÂàÜÊòØÂê¶ÊúâÊïà„ÄÇ
   * @param {number} aScore - AÊñπÂæóÂàÜ„ÄÇ
   * @param {number} bScore - BÊñπÂæóÂàÜ„ÄÇ
   * @returns {object} È©óË≠âÁµêÊûúÁâ©‰ª∂„ÄÇ
   */
  const validateRegularGameScore = (aScore, bScore) => {
    const minScore = Math.min(aScore, bScore)
    const maxScore = Math.max(aScore, bScore)
    const scoreDiff = Math.abs(aScore - bScore)

    // ÊÉÖÊ≥Å1: ÈÇÑÊ≤íÂà∞ 3:3ÔºåÂÖàÂà∞ 4 ÂàÜ‰∏îÈ†òÂÖà 1 ÂàÜÂ∞±Ë¥è
    if (minScore < 3) {
      if (maxScore >= 4 && scoreDiff >= 1) {
        const winner = aScore > bScore ? 'A' : 'B'
        return { isValid: true, message: '', gameFinished: true, winner }
      }
      // Ê™¢Êü•ÊòØÂê¶Âá∫ÁèæÁÑ°ÊïàÂàÜÊï∏ (‰æãÂ¶Ç‰∏ÄÊñπÂ∑≤Âà∞4ÂàÜ‰ΩÜÊú™È†òÂÖà)
      if (maxScore >= 4 && scoreDiff < 1) {
        return { isValid: false, message: 'ÂàÜÊï∏Â∑≤ÈÅîÂà∞ÂãùË≤†Èªû‰ΩÜÊú™ÊãâÈñãÂ∑ÆË∑ùÔºåÁÑ°Êïà' }
      }
      return { isValid: true, message: '', gameFinished: false, winner: null }
    }

    // ÊÉÖÊ≥Å2: Â∑≤Á∂ìÂà∞ 3:3 ÊàñÊõ¥È´òÔºåÈúÄË¶ÅÈ†òÂÖà 2 ÂàÜÊâçËÉΩÁç≤Âãù
    if (minScore >= 3) {
      if (scoreDiff >= 2) {
        const winner = aScore > bScore ? 'A' : 'B'
        return { isValid: true, message: '', gameFinished: true, winner }
      }
      return { isValid: true, message: '', gameFinished: false, winner: null }
    }

    return { isValid: true, message: '', gameFinished: false, winner: null }
  }

  /**
   * È©óË≠âÁ∏ΩÊØîË≥ΩÂàÜÊï∏ÊòØÂê¶ÊúâÊïà„ÄÇ
   * @param {number} aGames - AÊñπË¥èÂæóÁöÑÁ∏ΩÂ±ÄÊï∏„ÄÇ
   * @param {number} bGames - BÊñπË¥èÂæóÁöÑÁ∏ΩÂ±ÄÊï∏„ÄÇ
   * @param {string} format - ÊØîË≥ΩÊ†ºÂºè (‰æãÂ¶Ç 'games_5')„ÄÇ
   * @returns {object} ÂåÖÂê´ isValid Âíå message ÁöÑÁâ©‰ª∂„ÄÇ
   */
  const validateMatchScore = (aGames, bGames, format) => {
    const gamesToWin = scoreInputMax.value // Áç≤ÂèñÁï∂ÂâçË≥ΩÂà∂‰∏ãË¥èÂæóÊØîË≥ΩÊâÄÈúÄÁöÑÂ±ÄÊï∏

    // 1. Âü∫Êú¨È©óË≠âÔºöÂàÜÊï∏‰∏çËÉΩÁÇ∫Ë≤†Êï∏
    if (aGames < 0 || bGames < 0) {
      return { isValid: false, message: 'ÊØîË≥ΩÂàÜÊï∏‰∏çËÉΩÁÇ∫Ë≤†Êï∏' }
    }

    // 2. ‰∏çËÉΩÂπ≥Â±ÄÔºöÁ∏ΩÂ±ÄÊï∏‰∏çËÉΩÁõ∏Âêå
    if (aGames === bGames) {
      return { isValid: false, message: 'ÊØîË≥ΩÂàÜÊï∏‰∏çËÉΩÁõ∏ÂêåÔºåÂøÖÈ†àÂàÜÂá∫ÂãùË≤†' }
    }

    // 3. ÂøÖÈ†àÊúâ‰∏ÄÊñπÈÅîÂà∞Áç≤ÂãùÂ±ÄÊï∏
    if (aGames < gamesToWin && bGames < gamesToWin) {
      return { isValid: false, message: `ÊØîË≥ΩÂ∞öÊú™ÁµêÊùüÔºåÈúÄË¶ÅÊúâ‰∏ÄÊñπÈÅîÂà∞ ${gamesToWin} Â±Ä` }
    }

    // 4. Âè™ËÉΩÊúâ‰∏ÄÊñπÈÅîÂà∞Áç≤ÂãùÂ±ÄÊï∏ (‰∏çËÉΩÈõôÊñπÈÉΩË∂ÖÈÅéÊàñÈÅîÂà∞ÂãùÂ†¥Êï∏)
    if (aGames >= gamesToWin && bGames >= gamesToWin) {
      return { isValid: false, message: `ÁÑ°ÊïàÂàÜÊï∏ÔºöÈõôÊñπÈÉΩÈÅîÂà∞‰∫ÜÁç≤ÂãùÂ±ÄÊï∏ ${gamesToWin}` }
    }

    // 5. ÈÅîÂà∞Áç≤ÂãùÂ±ÄÊï∏ÁöÑ‰∏ÄÊñπÂøÖÈ†àÈ†òÂÖà
    if (aGames >= gamesToWin && aGames <= bGames) {
      return { isValid: false, message: `ÁÑ°ÊïàÂàÜÊï∏ÔºöAÊñπÈÅîÂà∞ ${gamesToWin} Â±Ä‰ΩÜÊú™È†òÂÖàBÊñπ` }
    }

    if (bGames >= gamesToWin && bGames <= aGames) {
      return { isValid: false, message: `ÁÑ°ÊïàÂàÜÊï∏ÔºöBÊñπÈÅîÂà∞ ${gamesToWin} Â±Ä‰ΩÜÊú™È†òÂÖàAÊñπ` }
    }

    return { isValid: true, message: '' } // È©óË≠âÈÄöÈÅé
  }

  /**
   * Âú®Êèê‰∫§ÂâçÈ©óË≠âÊâÄÊúâË©≥Á¥∞ÊØîÂàÜÊòØÂê¶ÊúâÊïà„ÄÇ
   * Âè™ÊúâÂú®ÂïüÁî®Ë©≥Á¥∞ÊØîÂàÜË®òÈåÑÊôÇÊâçÊúÉÂü∑Ë°åÊ≠§È©óË≠â„ÄÇ
   * @returns {object} ÂåÖÂê´ isValid Âíå message ÁöÑÁâ©‰ª∂„ÄÇ
   */
  const validateDetailedScoresBeforeSubmit = () => {
    if (!enableDetailedScoring.value) return { isValid: true } // Â¶ÇÊûúÊú™ÂïüÁî®Ë©≥Á¥∞ÊØîÂàÜÔºåÂâáÁÑ°ÈúÄÈ©óË≠â

    for (let i = 1; i <= maxGames.value; i++) {
      const aScore = matchForm.value[`game${i}_a_score`] || 0
      const bScore = matchForm.value[`game${i}_b_score`] || 0

      // Âè™È©óË≠âÊúâËº∏ÂÖ•ÂàÜÊï∏ÁöÑÂ±Ä
      if (aScore > 0 || bScore > 0) {
        const validation = validateSoftTennisScore(aScore, bScore, i)
        if (!validation.isValid) {
          const gameType = isTiebreakGame(i) ? 'TiebreakÂ±Ä' : 'Â±Ä'
          return {
            isValid: false,
            message: `Á¨¨${i}${gameType}ÂàÜÊï∏ÁÑ°Êïà: ${validation.message}` // ËøîÂõûÂÖ∑È´îÈåØË™§‰ø°ÊÅØ
          }
        }
      }
    }
    return { isValid: true } // ÊâÄÊúâË©≥Á¥∞ÊØîÂàÜÈÉΩÊúâÊïà
  }

  /**
   * ÈáçÁΩÆÊåáÂÆöÂ±ÄÊï∏ÁöÑÊØîÂàÜ„ÄÇ
   * @param {number} gameNum - Ë¶ÅÈáçÁΩÆÁöÑÂ±ÄÊï∏„ÄÇ
   */
  const resetGameScore = gameNum => {
    matchForm.value[`game${gameNum}_a_score`] = 0
    matchForm.value[`game${gameNum}_b_score`] = 0
    updateGameStatistics() // ÈáçÁΩÆÂæåÊõ¥Êñ∞Á∏ΩÂ±ÄÊï∏
    message.info(`Á¨¨${gameNum}Â±ÄÊØîÂàÜÂ∑≤ÈáçÁΩÆ`)
  }

  /**
   * Ê†πÊìöË©≥Á¥∞ÊØîÂàÜÊõ¥Êñ∞Á∏ΩÂ±ÄÊï∏ (a_games, b_games)„ÄÇ
   * Ê≠§ÊñπÊ≥ï‰πüÊúÉÊ™¢Êü•Ë©≥Á¥∞ÊØîÂàÜÁöÑÊúâÊïàÊÄß‰∏¶Áµ¶Âá∫ÊèêÁ§∫„ÄÇ
   */
  const updateGameStatistics = () => {
    if (enableDetailedScoring.value) {
      let aWins = 0
      let bWins = 0
      let hasInvalidScore = false
      let invalidMessage = ''

      for (let i = 1; i <= maxGames.value; i++) {
        const aScore = matchForm.value[`game${i}_a_score`] || 0
        const bScore = matchForm.value[`game${i}_b_score`] || 0

        // Âè™ËôïÁêÜÊúâËº∏ÂÖ•ÂàÜÊï∏ÁöÑÂ±Ä
        if (aScore > 0 || bScore > 0) {
          const validation = validateSoftTennisScore(aScore, bScore, i)

          if (!validation.isValid) {
            hasInvalidScore = true // Ê®ôË®òÁÇ∫Â≠òÂú®ÁÑ°ÊïàÂàÜÊï∏
            const gameType = isTiebreakGame(i) ? 'TiebreakÂ±Ä' : 'Â±Ä'
            invalidMessage = `Á¨¨${i}${gameType}: ${validation.message}`
            break // ÊâæÂà∞Á¨¨‰∏ÄÂÄãÁÑ°ÊïàÂàÜÊï∏Â∞±ÂÅúÊ≠¢
          }

          if (validation.gameFinished && validation.winner) {
            // Â¶ÇÊûúË©≤Â±ÄÂ∑≤ÂÆåÊàêÔºåË®àÂÖ•ÂãùÂ†¥Êï∏
            if (validation.winner === 'A') {
              aWins++
            } else {
              bWins++
            }
          }
        }
      }

      // Â¶ÇÊûúÊúâ‰ªª‰ΩïÁÑ°ÊïàÂàÜÊï∏ÔºåÈ°ØÁ§∫ÈåØË™§ÊèêÁ§∫‰∏¶ËøîÂõû
      if (hasInvalidScore) {
        message.error(invalidMessage, { duration: 5000 })
        return
      }

      // Êõ¥Êñ∞Ë°®ÂñÆ‰∏≠ÁöÑÁ∏ΩÂ±ÄÊï∏
      matchForm.value.a_games = aWins
      matchForm.value.b_games = bWins

      // Ê™¢Êü•ÊØîË≥ΩÊòØÂê¶Â∑≤ÁµêÊùüÔºå‰∏¶Áµ¶Âá∫ÊèêÁ§∫
      if (matchCompleted.value && (aWins > 0 || bWins > 0)) {
        const winner = getMatchWinner()
        if (winner !== 'Êú™Ê±∫ÂÆö') {
          message.success(`ÊØîË≥ΩÁµêÊùüÔºÅ${winner} Áç≤ÂãùÔºÅ`, { duration: 3000 })
        }
      }
    }
  }

  /**
   * Áç≤ÂèñÂñÆÂ±ÄÁöÑÊ®ôÈ°å (‰æãÂ¶Ç 'Á¨¨1Â±Ä' Êàñ 'Á¨¨5Â±Ä (Tiebreak)')„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {string} Â±ÄÊï∏Ê®ôÈ°å„ÄÇ
   */
  const getGameTitle = gameNum => {
    return isTiebreakGame(gameNum) ? `Á¨¨${gameNum}Â±Ä (Tiebreak)` : `Á¨¨${gameNum}Â±Ä`
  }

  /**
   * Ê™¢Êü•Áµ¶ÂÆöÁöÑ‰∏ÄÊñπÊòØÂê¶ÊòØÁ¨¨‰∏ÄÂ±ÄÁöÑÁôºÁêÉÊñπ„ÄÇ
   * @param {string} side - 'side_a' Êàñ 'side_b'„ÄÇ
   * @returns {boolean} Â¶ÇÊûúÊòØÂâáÁÇ∫ trueÔºåÂê¶ÂâáÁÇ∫ false„ÄÇ
   */
  const isFirstServeTeam = side => {
    return matchForm.value.first_serve_side === side
  }

  /**
   * Áç≤ÂèñÊØîË≥ΩÁöÑÊúÄÁµÇÂãùËÄÖ„ÄÇ
   * @returns {string} 'AÊñπ', 'BÊñπ' Êàñ 'Êú™Ê±∫ÂÆö'„ÄÇ
   */
  const getMatchWinner = () => {
    if (detailedStats.value.aWins >= gamesToWin.value) return 'AÊñπ'
    if (detailedStats.value.bWins >= gamesToWin.value) return 'BÊñπ'
    return 'Êú™Ê±∫ÂÆö'
  }

  /**
   * ÈáçÁΩÆÊâÄÊúâË©≥Á¥∞Â±ÄÁöÑÊØîÂàÜÂíåÁ∏ΩÊØîÂàÜ„ÄÇ
   */
  const resetDetailedScores = () => {
    for (let i = 1; i <= maxGames.value; i++) {
      matchForm.value[`game${i}_a_score`] = 0
      matchForm.value[`game${i}_b_score`] = 0
    }
    matchForm.value.a_games = 0
    matchForm.value.b_games = 0
    message.info('Ë©≥Á¥∞ÊØîÂàÜÂ∑≤ÈáçÁΩÆ')
  }

  /**
   * ÈáçÁΩÆÊï¥ÂÄãË°®ÂñÆÂà∞ÂàùÂßãÁãÄÊÖã„ÄÇ
   */
  const resetForm = () => {
    matchForm.value = {
      match_date_ts: new Date().getTime(),
      match_type: 'doubles',
      match_format: 'games_9',
      player1_id: null,
      player2_id: null,
      player3_id: null,
      player4_id: null,
      a_games: 0,
      b_games: 0,
      match_notes: '',
      court_surface: 'hard_court',
      court_environment: 'outdoor',
      time_slot: 'evening',
      total_points: null,
      duration_minutes: null,
      youtube_url: '',
      first_serve_side: null // ‰πüË¶ÅÈáçÁΩÆÁôºÁêÉÊñπ
    }

    // Á¢∫‰øùÊâÄÊúâË©≥Á¥∞ÂàÜÊï∏ÈÉΩË¢´ÈáçÁΩÆ
    for (let i = 1; i <= 9; i++) {
      matchForm.value[`game${i}_a_score`] = 0
      matchForm.value[`game${i}_b_score`] = 0
    }
    enableDetailedScoring.value = false // ÈáçÁΩÆË©≥Á¥∞ÊØîÂàÜÈñãÈóú
    message.info('Ë°®ÂñÆÂ∑≤ÈáçÁΩÆ')
  }

  /**
   * Â∞éËà™Âõû 'ManagementCenter' È†ÅÈù¢„ÄÇ
   */
  const goBack = () => {
    router.push({ name: 'ManagementCenter' })
  }

  // 7. Ë®àÁÆóÂ±¨ÊÄß (Computed Properties)
  /**
   * Ë®àÁÆóÁï∂ÂâçË≥ΩÂà∂‰∏ãÁöÑÊúÄÂ§ßÂ±ÄÊï∏„ÄÇ
   * ‰æãÂ¶ÇÔºö‰∫îÂ±ÄÂà∂ÊúÄÂ§ö 5 Â±ÄÔºå‰πùÂ±ÄÂà∂ÊúÄÂ§ö 9 Â±Ä„ÄÇ
   */
  const maxGames = computed(() => {
    const format = matchForm.value.match_format
    return format ? matchFormatConfig[format]?.maxGames || 9 : 9 // È†êË®≠ÁÇ∫ 9 Â±Ä
  })

  /**
   * Ë®àÁÆóÊØèË°åÈ°ØÁ§∫ÁöÑÊØîÂàÜÂç°ÁâáÊï∏Èáè (Áî®Êñº‰ΩàÂ±Ä)„ÄÇ
   */
  const getCardsPerRow = computed(() => {
    if (maxGames.value <= 5) return 5
    if (maxGames.value <= 7) return 7
    return 9
  })

  /**
   * Ë®àÁÆóË©≥Á¥∞ÁöÑÊØîË≥ΩÁµ±Ë®àÊï∏ÊìöÔºåÂåÖÊã¨ÂãùÂ†¥Êï∏„ÄÅÂÆåÊàêÂ±ÄÊï∏„ÄÅÁ∏ΩÂàÜÊï∏Á≠â„ÄÇ
   */
  const detailedStats = computed(() => {
    let aWins = 0 // AÊñπË¥èÂæóÂ±ÄÊï∏
    let bWins = 0 // BÊñπË¥èÂæóÂ±ÄÊï∏
    let completedGames = 0 // Â∑≤ÂÆåÊàêÂ±ÄÊï∏
    let totalPoints = 0 // Á∏ΩÂàÜÊï∏
    let inProgressGames = 0 // ÈÄ≤Ë°å‰∏≠Â±ÄÊï∏

    for (let i = 1; i <= maxGames.value; i++) {
      const aScore = matchForm.value[`game${i}_a_score`] || 0
      const bScore = matchForm.value[`game${i}_b_score`] || 0

      // Âè™Áµ±Ë®àÊúâËº∏ÂÖ•ÂàÜÊï∏ÁöÑÂ±Ä
      if (aScore > 0 || bScore > 0) {
        totalPoints += aScore + bScore // Á¥ØÂä†Á∏ΩÂàÜ

        const validation = validateSoftTennisScore(aScore, bScore, i)

        if (validation.gameFinished && validation.winner) {
          completedGames++ // Ë®àÊï∏Â∑≤ÂÆåÊàêÁöÑÂ±Ä
          if (validation.winner === 'A') {
            aWins++
          } else {
            bWins++
          }
        } else if (validation.isValid) {
          inProgressGames++ // Ë®àÊï∏ÈÄ≤Ë°å‰∏≠ÁöÑÂ±Ä (ÊúâÊïà‰ΩÜÊú™ÂÆåÊàê)
        }
      }
    }

    return {
      aWins,
      bWins,
      completedGames,
      totalPoints,
      inProgressGames,
      totalActiveGames: completedGames + inProgressGames // Á∏ΩÊ¥ªË∫çÂ±ÄÊï∏ (Â∑≤ÂÆåÊàê + ÈÄ≤Ë°å‰∏≠)
    }
  })

  /**
   * Ê†πÊìöÂñÆÂ±ÄÊØîÂàÜÁãÄÊÖãËøîÂõûÂ∞çÊáâÁöÑ UI Ê®£ÂºèÈ°ûÂûã„ÄÇ
   * Áî®ÊñºÈ°ØÁ§∫ÊØîÂàÜËº∏ÂÖ•Ê°ÜÁöÑÁãÄÊÖãÊèêÁ§∫ (‰æãÂ¶Ç 'success', 'error', 'warning' Á≠â)„ÄÇ
   */
  const getGameResultType = gameNum => {
    const result = getGameResult(gameNum) // Áç≤ÂèñÂ±ÄÁµêÊûú (AÂãù/BÂãù/ÈÄ≤Ë°å‰∏≠)
    const status = getGameStatus(gameNum) // Áç≤ÂèñÂ±ÄË©≥Á¥∞ÁãÄÊÖã

    if (status.status === 'invalid') return 'error' // ÁÑ°ÊïàÂàÜÊï∏È°ØÁ§∫Á¥ÖËâ≤
    if (result === 'AÂãù') return 'success' // AÂãùÈ°ØÁ§∫Á∂†Ëâ≤
    if (result === 'BÂãù') return 'warning' // BÂãùÈ°ØÁ§∫ÈªÉËâ≤ (ÊàñÂèØÊîπÁÇ∫ÂÖ∂‰ªñÈ°èËâ≤)
    if (status.status === 'deuce') return 'info' // Âπ≥ÂàÜÈ°ØÁ§∫ËóçËâ≤
    if (status.status === 'advantage') return 'primary' // È†òÂÖàÈ°ØÁ§∫‰∏ªËâ≤

    return 'default' // È†êË®≠ÁãÄÊÖã (Êú™ÈñãÂßãÊàñÈÄ≤Ë°å‰∏≠)
  }

  /**
   * Áç≤ÂèñÂñÆÂ±ÄÂàÜÊï∏Ëº∏ÂÖ•Ê°ÜÁöÑÈ©óË≠âÁãÄÊÖãÂíåÊèêÁ§∫‰ø°ÊÅØ„ÄÇ
   * @param {number} gameNum - Â±ÄÊï∏„ÄÇ
   * @returns {object|null} ÂåÖÂê´ type (È°ûÂûã) Âíå message (‰ø°ÊÅØ) ÁöÑÁâ©‰ª∂ÔºåÂ¶ÇÊûúÊ≤íÊúâÊèêÁ§∫ÂâáÁÇ∫ null„ÄÇ
   */
  const getScoreInputStatus = gameNum => {
    const aScore = matchForm.value[`game${gameNum}_a_score`] || 0
    const bScore = matchForm.value[`game${gameNum}_b_score`] || 0

    if (aScore === 0 && bScore === 0) return null // Â¶ÇÊûúÊ≤íÊúâÂàÜÊï∏Ôºå‰∏çÈ°ØÁ§∫ÊèêÁ§∫

    const validation = validateSoftTennisScore(aScore, bScore, gameNum)

    if (!validation.isValid) {
      return { type: 'error', message: validation.message } // ÁÑ°ÊïàÂàÜÊï∏
    }

    const status = getGameStatus(gameNum)

    if (status.status === 'finished') {
      return { type: 'success', message: status.message } // Â±ÄÂ∑≤ÂÆåÊàê
    }

    if (status.status === 'deuce' || status.status === 'advantage') {
      return { type: 'warning', message: status.message } // Âπ≥ÂàÜÊàñÈ†òÂÖà (Êé•ËøëÁµêÊùü)
    }

    if (status.status === 'close') {
      return { type: 'info', message: status.message } // Êé•ËøëÂãùË≤†Èªû
    }

    return null // ÂÖ∂‰ªñÊÉÖÊ≥Å‰∏çÈ°ØÁ§∫ÊèêÁ§∫
  }

  /**
   * Ë®àÁÆóÊØîË≥ΩÊòØÂê¶Â∑≤ÁµêÊùü„ÄÇ
   */
  const matchCompleted = computed(() => {
    // Âè™Ë¶ÅAÊñπÊàñBÊñπÈÅîÂà∞Áç≤ÂãùÊâÄÈúÄÂ±ÄÊï∏ÔºåÊØîË≥ΩÂ∞±ÁµêÊùü
    return detailedStats.value.aWins >= gamesToWin.value || detailedStats.value.bWins >= gamesToWin.value
  })

  /**
   * Ë®àÁÆóÁï∂ÂâçË≥ΩÂà∂‰∏ãË¥èÂæóÊØîË≥ΩÊâÄÈúÄÁöÑÂ±ÄÊï∏„ÄÇ
   * ‰æãÂ¶ÇÔºö‰∫îÂ±ÄÂà∂ÈúÄË¶ÅË¥è 3 Â±ÄÔºå‰πùÂ±ÄÂà∂ÈúÄË¶ÅË¥è 5 Â±Ä„ÄÇ
   */
  const gamesToWin = computed(() => {
    const formatMap = {
      games_5: 3, // 5Â±Ä3Âãù
      games_7: 4, // 7Â±Ä4Âãù
      games_9: 5 // 9Â±Ä5Âãù
    }
    return formatMap[matchForm.value.match_format] || 5 // È†êË®≠ÁÇ∫ 5
  })

  /**
   * Ë®àÁÆóÂàÜÊï∏Ëº∏ÂÖ•ÁöÑÊúÄÂ§ßÂÄº (Áî®ÊñºÂâçÁ´ØÈ©óË≠âÔºåÈò≤Ê≠¢Ëº∏ÂÖ•ÈÅéÂ§ßÁöÑÊï∏Â≠ó)„ÄÇ
   * ÈÄôÂÄãÂÄºÊáâË©≤ËàáÂØ¶ÈöõÁöÑË¥èÂ±ÄÂàÜÊï∏ÊéõÈâ§„ÄÇ
   */
  const scoreInputMax = computed(() => {
    const formatMap = {
      games_5: 3, // ‰∫îÂ±ÄÂà∂Ë¥èÂæóÊØîË≥ΩÈúÄË¶Å 3 Â±Ä
      games_7: 4, // ‰∏ÉÂ±ÄÂà∂Ë¥èÂæóÊØîË≥ΩÈúÄË¶Å 4 Â±Ä
      games_9: 5 // ‰πùÂ±ÄÂà∂Ë¥èÂæóÊØîË≥ΩÈúÄË¶Å 5 Â±Ä
    }
    return formatMap[matchForm.value.match_format] || 5
  })

  /**
   * Ë®àÁÆóË°®ÂñÆÊòØÂê¶ÂèØ‰ª•Êèê‰∫§„ÄÇ
   * Ê™¢Êü•ÂøÖÂ°´È†ÖÂíåÁ∏ΩÊØîÂàÜÈ©óË≠â„ÄÇ
   */
  const canSubmit = computed(() => {
    const form = matchForm.value

    // Âü∫Êú¨ÂøÖÂ°´Ê™¢Êü•ÔºöÁêÉÂì°1ÂíåÁêÉÂì°3ÂøÖÈ†àÈÅ∏Êìá
    if (!form.player1_id || !form.player3_id) {
      return false
    }

    // Â¶ÇÊûúÊòØÈõôÊâìÊ®°ÂºèÔºåÁêÉÂì°2ÂíåÁêÉÂì°4‰πüÂøÖÈ†àÈÅ∏Êìá
    if (form.match_type === 'doubles' && (!form.player2_id || !form.player4_id)) {
      return false
    }

    // ‰ΩøÁî®Êñ∞ÁöÑÁ∏ΩÊØîÂàÜÈ©óË≠âÈÇèËºØ‰æÜÂà§Êñ∑ÊòØÂê¶ÂèØ‰ª•Êèê‰∫§
    const scoreValidation = validateMatchScore(form.a_games, form.b_games, form.match_format)

    return scoreValidation.isValid
  })

  /**
   * Ë®àÁÆóÊØîË≥ΩÁöÑÁ∏ΩÈ´îÁãÄÊÖã (ÊúâÊïàÊÄß„ÄÅÂÆåÊàêÂ∫¶„ÄÅÊ∂àÊÅØ)„ÄÇ
   */
  const matchStatus = computed(() => {
    const validation = validateMatchScore(
      matchForm.value.a_games,
      matchForm.value.b_games,
      matchForm.value.match_format
    )

    return {
      isValid: validation.isValid, // Á∏ΩÊØîÂàÜÊòØÂê¶ÊúâÊïà
      message: validation.message, // È©óË≠âÊ∂àÊÅØ
      // ÊØîË≥ΩÊòØÂê¶ÂÆåÊàêÔºöÁ∏ΩÊØîÂàÜÊúâÊïà‰∏îÊ≤íÊúâ 'PENDING' ÁãÄÊÖã (ÈÄôÂÄã 'PENDING' ÂèØËÉΩÊòØËàäÈÇèËºØÊÆòÁïôÔºåÂèØÊ†πÊìöÂØ¶ÈöõÂæåÁ´ØËôïÁêÜË™øÊï¥)
      isComplete: validation.isValid && matchForm.value.side_a_outcome !== 'PENDING'
    }
  })

  // 8. Ë°®ÂñÆÈ©óË≠âË¶èÂâá (Form Rules)
  // Naive UI Ë°®ÂñÆÈ©óË≠âË¶èÂâáÂÆöÁæ©
  const formRules = {
    match_date: [{ required: true, message: 'Ë´ãÈÅ∏ÊìáÊØîË≥ΩÊó•Êúü', trigger: 'change' }],
    match_type: [{ required: true, message: 'Ë´ãÈÅ∏ÊìáÊØîË≥ΩÈ°ûÂûã', trigger: 'change' }],
    match_format: [{ required: true, message: 'Ë´ãÈÅ∏ÊìáË≥ΩÂà∂', trigger: 'change' }],
    player1_id: [{ required: true, message: 'Ë´ãÈÅ∏ÊìáÁêÉÂì°1', trigger: 'change' }],
    player3_id: [{ required: true, message: 'Ë´ãÈÅ∏ÊìáÁêÉÂì°3', trigger: 'change' }],
    // AÊñπÁ∏ΩÂ±ÄÊï∏ÁöÑÈ©óË≠âË¶èÂâá
    a_games: [
      { required: true, message: 'Ë´ãËº∏ÂÖ•AÊñπÂæóÂàÜ', trigger: 'blur' },
      { type: 'number', min: 0, message: 'ÂàÜÊï∏‰∏çËÉΩÁÇ∫Ë≤†Êï∏', trigger: 'blur' },
      {
        // Ëá™ÂÆöÁæ©È©óË≠âÂô®Ôºå‰ΩøÁî® validateMatchScore Ê™¢Êü•Á∏ΩÂ±ÄÊï∏ÊúâÊïàÊÄß
        validator: (rule, value, callback) => {
          const validation = validateMatchScore(value, matchForm.value.b_games, matchForm.value.match_format)
          if (!validation.isValid) {
            callback(new Error(validation.message)) // È©óË≠âÂ§±ÊïóÂâáÊããÂá∫ÈåØË™§
          } else {
            callback() // È©óË≠âÊàêÂäü
          }
        },
        trigger: 'blur' // Â§±ÂéªÁÑ¶ÈªûÊôÇËß∏Áôº
      }
    ],
    // BÊñπÁ∏ΩÂ±ÄÊï∏ÁöÑÈ©óË≠âË¶èÂâá (Ëàá A ÊñπÈ°û‰ºº)
    b_games: [
      { required: true, message: 'Ë´ãËº∏ÂÖ•BÊñπÂæóÂàÜ', trigger: 'blur' },
      { type: 'number', min: 0, message: 'ÂàÜÊï∏‰∏çËÉΩÁÇ∫Ë≤†Êï∏', trigger: 'blur' },
      {
        validator: (rule, value, callback) => {
          const validation = validateMatchScore(matchForm.value.a_games, value, matchForm.value.match_format)
          if (!validation.isValid) {
            callback(new Error(validation.message))
          } else {
            callback()
          }
        },
        trigger: 'blur'
      }
    ]
  }

  // 9. ‰∫ã‰ª∂ËôïÁêÜÂáΩÊï∏ (Event Handlers)
  /**
   * ËôïÁêÜÊØîË≥ΩË®òÈåÑÁöÑÊèê‰∫§ÈÇèËºØ„ÄÇ
   * ÂåÖÂê´ÂâçÁ´ØË°®ÂñÆÈ©óË≠â„ÄÅÊï∏ÊìöÁµÑË£ù„ÄÅAPI Ë´ãÊ±ÇÂíåÈåØË™§ËôïÁêÜ„ÄÇ
   */
  const handleRecordMatch = async () => {
    try {
      // Ëß∏Áôº Naive UI Ë°®ÂñÆÁöÑÂü∫Êú¨È©óË≠â
      const valid = await formRef.value?.validate()
      if (!valid) {
        message.error('Ë´ã‰øÆÊ≠£Ë°®ÂñÆ‰∏≠ÁöÑÈåØË™§„ÄÇ')
        return
      }
    } catch (e) {
      // ÊçïÁç≤Ë°®ÂñÆÈ©óË≠âÊú¨Ë∫´ÂèØËÉΩÊããÂá∫ÁöÑÈåØË™§
      message.error('Ë´ã‰øÆÊ≠£Ë°®ÂñÆ‰∏≠ÁöÑÈåØË™§„ÄÇ')
      return
    }

    // ÂÜçÊ¨°ÈÄ≤Ë°åÂÆ¢Êà∂Á´ØÁ∏ΩÊØîÂàÜÈ†êÈ©óË≠â (Á¢∫‰øùÂú®Êèê‰∫§ÂâçÊúÄÂæåÊ™¢Êü•‰∏ÄÊ¨°)
    const localValidation = validateMatchScore(
      matchForm.value.a_games,
      matchForm.value.b_games,
      matchForm.value.match_format
    )

    if (!localValidation.isValid) {
      message.error(localValidation.message)
      return
    }

    submitting.value = true // Ë®≠ÂÆöÊèê‰∫§ÁãÄÊÖãÁÇ∫ true

    try {
      // Ê†ºÂºèÂåñÊó•ÊúüÊôÇÈñìÊà≥ÁÇ∫ YYYY-MM-DD Ê†ºÂºè
      const formatDate = timestamp => {
        if (!timestamp) return null
        const date = new Date(timestamp)
        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`
      }

      // ÁµÑË£ùË¶ÅÁôºÈÄÅÂà∞ÂæåÁ´ØÁöÑ payload Êï∏Êìö
      const payload = {
        match_date: formatDate(matchForm.value.match_date_ts),
        match_type: matchForm.value.match_type,
        match_format: matchForm.value.match_format,
        player1_id: matchForm.value.player1_id,
        // Â¶ÇÊûúÊòØÈõôÊâìÔºåÊâçÂåÖÂê´ player2_id
        player2_id: matchForm.value.match_type === 'doubles' ? matchForm.value.player2_id : null,
        player3_id: matchForm.value.player3_id,
        // Â¶ÇÊûúÊòØÈõôÊâìÔºåÊâçÂåÖÂê´ player4_id
        player4_id: matchForm.value.match_type === 'doubles' ? matchForm.value.player4_id : null,
        a_games: matchForm.value.a_games,
        b_games: matchForm.value.b_games,
        match_notes: matchForm.value.match_notes || null, // Á©∫Â≠óÁ¨¶‰∏≤ËΩâÁÇ∫ null
        court_surface: matchForm.value.court_surface || null,
        court_environment: matchForm.value.court_environment || null,
        time_slot: matchForm.value.time_slot || null,
        total_points: matchForm.value.total_points || null,
        duration_minutes: matchForm.value.duration_minutes || null,
        youtube_url: matchForm.value.youtube_url || null,
        first_serve_side: matchForm.value.first_serve_side || null // Á¨¨‰∏ÄÂ±ÄÁôºÁêÉÊñπ
      }

      // Â¶ÇÊûúÂïüÁî®Ë©≥Á¥∞ÊØîÂàÜÔºåÂâáÂ∞áÊØèÂ±ÄÂàÜÊï∏Âä†ÂÖ• payload
      if (enableDetailedScoring.value) {
        // Âú®ÁôºÈÄÅÂâçÂÜçÊ¨°È©óË≠âË©≥Á¥∞ÊØîÂàÜ (ÈõôÈáç‰øùÈö™)
        const scoreValidation = validateDetailedScoresBeforeSubmit()
        if (!scoreValidation.isValid) {
          message.error(scoreValidation.message)
          return
        }
        for (let i = 1; i <= maxGames.value; i++) {
          payload[`game${i}_a_score`] = matchForm.value[`game${i}_a_score`] || 0
          payload[`game${i}_b_score`] = matchForm.value[`game${i}_b_score`] || 0
        }
      }

      console.log('ÁôºÈÄÅÊñ∞Â¢ûË´ãÊ±Ç:', payload)

      // Ê†πÊìöÊòØÂê¶ÂïüÁî®Ë©≥Á¥∞ÊØîÂàÜÔºåÈÅ∏Êìá‰∏çÂêåÁöÑ API Á´ØÈªû
      const endpoint = enableDetailedScoring.value ? '/match-records/detailed' : '/match-records'
      const response = await apiClient.post(endpoint, payload) // ÁôºÈÄÅ POST Ë´ãÊ±Ç
      console.log('Êñ∞Â¢ûÈüøÊáâ:', response.data)

      message.success(response.data.message || 'ÊØîË≥ΩÁµêÊûúÂ∑≤ÊàêÂäüÂÑ≤Â≠òÔºÅ') // È°ØÁ§∫ÊàêÂäüÊ∂àÊÅØ

      // 1.5 ÁßíÂæåË∑≥ËΩâÂà∞ Leaderboard È†ÅÈù¢
      setTimeout(() => {
        router.push({ name: 'Leaderboard' })
      }, 1500)
    } catch (err) {
      console.error('Êñ∞Â¢ûÂ§±ÊïóË©≥Á¥∞‰ø°ÊÅØ:', {
        error: err,
        response: err.response?.data,
        status: err.response?.status,
        statusText: err.response?.statusText
      })

      const errorData = err.response?.data

      // ËôïÁêÜ‰æÜËá™ÂæåÁ´ØÁöÑÂàÜÊï∏È©óË≠âÈåØË™§
      if (errorData?.error === 'score_validation_error') {
        const scoreInfo = errorData.score_info
        let detailedMessage = errorData.message

        if (scoreInfo) {
          detailedMessage += `\n\nË©≥Á¥∞‰ø°ÊÅØÔºö`
          detailedMessage += `\nAÊñπÂæóÂàÜÔºö${scoreInfo.a_games}`
          detailedMessage += `\nBÊñπÂæóÂàÜÔºö${scoreInfo.b_games}`
          detailedMessage += `\nÊØîË≥ΩÊ†ºÂºèÔºö${scoreInfo.match_format}`
          detailedMessage += `\nÁç≤ÂãùÈúÄË¶ÅÔºö${scoreInfo.games_to_win} Â±Ä`
        }

        message.error(detailedMessage, {
          duration: 8000, // ÈåØË™§Ê∂àÊÅØÈ°ØÁ§∫Êõ¥Èï∑ÊôÇÈñì
          closable: true // ÂÖÅË®±Áî®Êà∂ÊâãÂãïÈóúÈñâ
        })
        return
      }

      // ËôïÁêÜÂÖ∂‰ªñÈåØË™§È°ûÂûã
      let errorMessage = 'ÂÑ≤Â≠òÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ' // È†êË®≠ÈåØË™§Ê∂àÊÅØ

      if (errorData?.details) {
        // Â¶ÇÊûúÂæåÁ´ØËøîÂõûË©≥Á¥∞ÁöÑÈ©óË≠âÈåØË™§‰ø°ÊÅØ
        errorMessage = 'Ëº∏ÂÖ•Êï∏ÊìöÊúâË™§Ôºö\n' + Object.values(errorData.details).flat().join('\n')
        message.error(errorMessage, { duration: 7000, closable: true })
      } else if (errorData?.message) {
        // Â¶ÇÊûúÂæåÁ´ØËøîÂõû‰∏ÄËà¨ÈåØË™§Ê∂àÊÅØ
        errorMessage = errorData.message
        message.error(errorMessage)
      } else {
        // ÂÖ∂‰ªñÊú™Áü•ÈåØË™§
        message.error(errorMessage)
      }
    } finally {
      submitting.value = false // ÁÑ°Ë´ñÊàêÂäüÊàñÂ§±ÊïóÔºåÁµêÊùüÊèê‰∫§ÁãÄÊÖã
    }
  }

  // 10. Áõ£ËÅΩÂô® (Watchers)
  // Áõ£ËÅΩÁ∏ΩÂ±ÄÊï∏ (a_games, b_games) ÂíåË≥ΩÂà∂ (match_format) ÁöÑËÆäÂåñ
  watch(
    [() => matchForm.value.a_games, () => matchForm.value.b_games, () => matchForm.value.match_format],
    (newValues, oldValues) => {
      const [newAGames, newBGames, newFormat] = newValues
      const [oldAGames, oldBGames, oldFormat] = oldValues || []

      // Âè™ÊúâÁï∂Áõ∏ÈóúÂÄºÁúüÊ≠£ÊîπËÆäÊôÇÊâçÂü∑Ë°åÈÇèËºØ
      if (newAGames !== oldAGames || newBGames !== oldBGames || newFormat !== oldFormat) {
        // Âú®ÂâçÁ´ØÈÄ≤Ë°åÊú¨Âú∞È©óË≠âÔºåÊèê‰æõÂç≥ÊôÇÂèçÈ•ã
        const validation = validateMatchScore(newAGames, newBGames, newFormat)

        if (!validation.isValid && (newAGames > 0 || newBGames > 0)) {
          console.warn('ÂàÜÊï∏È©óË≠âÂ§±Êïó:', validation.message)
          // ÈÄôË£°ÂèØ‰ª•ÈÅ∏ÊìáÊòØÂê¶Ëß∏ÁôºË°®ÂñÆÈåØË™§ÊèêÁ§∫ÔºåÈÄöÂ∏∏Áî± formRules ËôïÁêÜ
        }

        // Ê†πÊìöÁ∏ΩÂ±ÄÊï∏Âà§Êñ∑ÊØîË≥ΩÁµêÊûú (WIN/LOSS/PENDING)
        const gamesToWin = scoreInputMax.value
        if (newAGames >= gamesToWin && newAGames > newBGames) {
          matchForm.value.side_a_outcome = 'WIN'
        } else if (newBGames >= gamesToWin && newBGames > newAGames) {
          matchForm.value.side_a_outcome = 'LOSS'
        } else {
          matchForm.value.side_a_outcome = 'PENDING'
        }
      }
    },
    { deep: true } // Ê∑±Â∫¶Áõ£ËÅΩ (Â¶ÇÊûúÂÖßÈÉ®Â∞çË±°ÊúâËÆäÂåñ‰πüÊúÉËß∏Áôº)
  )

  // Áõ£ËÅΩÊØîË≥ΩÈ°ûÂûã (match_type) ÁöÑËÆäÂåñ
  watch(
    () => matchForm.value.match_type,
    newType => {
      // Â¶ÇÊûúÂàáÊèõÂà∞ÂñÆÊâìÔºåÊ∏ÖÈô§ÈõôÊâìÁêÉÂì°ÁöÑÈÅ∏Êìá
      if (newType === 'singles') {
        matchForm.value.player2_id = null
        matchForm.value.player4_id = null
      }
    }
  )

  // Áõ£ËÅΩË≥ΩÂà∂ (match_format) ÁöÑËÆäÂåñ
  watch(
    () => matchForm.value.match_format,
    newFormat => {
      if (newFormat) {
        // Áï∂Ë≥ΩÂà∂ÊîπËÆäÊôÇÔºåÈáçÁΩÆÊâÄÊúâË©≥Á¥∞Â±ÄÁöÑÊØîÂàÜ
        for (let i = 1; i <= 9; i++) {
          matchForm.value[`game${i}_a_score`] = 0
          matchForm.value[`game${i}_b_score`] = 0
        }
        enableDetailedScoring.value = false // ÂêåÊôÇÈóúÈñâË©≥Á¥∞ÊØîÂàÜÈñãÈóú
        message.info('Ë≥ΩÂà∂Â∑≤ËÆäÊõ¥ÔºåË©≥Á¥∞ÊØîÂàÜÂ∑≤ÈáçÁΩÆ') // ÊèêÁ§∫Áî®Êà∂
      }
    }
  )
</script>

<style scoped>
  @import "@/assets/css/page/add-match-record-view.css";
</style>
